# 🎯 可视化元素选择器

> v5.0.0 核心功能 | 配置效率提升6-9倍 | XPath准确率98%+ ⭐

可视化元素选择器是系统最强大的功能，允许你在真实页面上直接点击元素，自动生成智能XPath表达式。

## 🌟 核心优势

### 为什么选择可视化选择器？

| 传统方式 | 可视化选择器 |
|---------|------------|
| ❌ 需要手写XPath | ✅ 点击元素自动生成 |
| ❌ 需要了解HTML结构 | ✅ 所见即所得 |
| ❌ 容易选到动态元素 | ✅ 自动过滤动态内容 |
| ❌ 需要反复测试 | ✅ 实时预览和验证 |
| ❌ 配置一个网站需30分钟+ | ✅ 仅需3-5分钟 |

### 关键特性

- 🖱️ **实时页面交互** - iframe加载真实页面，所见即所得
- 🎯 **智能元素选择** - 鼠标悬停高亮，点击即选择
- 🤖 **7种XPath策略** - 自动生成，置信度评分
- 📊 **置信度排序** - 最可靠的XPath排在最前
- ⚙️ **自动属性配置** - 智能识别链接、图片等元素类型
- 📋 **多字段管理** - 批量选择，统一管理
- ⚡ **效率提升6-9倍** - 大幅缩短配置时间
- ⬆️⬇️ **元素导航** - 向上选择父元素，向下返回子元素
- 🔄 **撤销/重做** - 支持操作撤销，最多20条历史记录
- 🧪 **实时测试** - 空格键测试XPath，高亮显示匹配元素
- ⌨️ **快捷键支持** - 完整的键盘快捷键操作
- 🚀 **自动打开** - 渲染成功后自动打开选择器
- 📍 **元素路径导航** - 面包屑显示当前元素层级
- 🔧 **XPath排序** - 按置信度、匹配数、类型或长度排序

---

## 🚀 快速开始

### 5分钟完成配置

#### 步骤1：打开爬虫管理器

访问 http://localhost:3000/crawler

#### 步骤2：新建配置

点击右上角"新建配置"按钮

#### 步骤3：选择内容类型和输入URL

1. 选择内容类型（小说/新闻/文章/博客）
2. 输入目标URL，例如：`https://www.example.com/book/12345`
3. 点击"开始渲染"按钮

#### 步骤4：等待页面加载

- 系统会使用Playwright加载页面
- 自动注入选择器脚本
- 加载完成后自动打开选择器（新功能！）

#### 步骤5：选择页面元素

1. **鼠标悬停** - 元素会高亮显示
2. **点击元素** - 自动生成7种XPath候选
3. **查看置信度** - 选择评分最高的XPath
4. **选择字段类型** - 标题/作者/内容等
5. **确认添加** - 点击"确认添加"按钮

#### 步骤6：批量导入字段

1. 重复步骤5选择其他字段
2. 点击"批量导入字段"按钮
3. 所有字段会自动填充到配置表单

#### 步骤7：保存配置

1. 填写网站基本信息（网站名称、基础URL、描述）
2. 点击"保存配置"
3. 完成！

---

## 🤖 智能XPath生成策略

系统使用7种智能策略生成XPath，每种策略都有置信度评分。

### 策略详解

#### 1. 语义化属性（置信度：95-98%）⭐⭐⭐⭐⭐

优先使用具有语义的HTML属性：

```xpath
//*[@data-testid='book-title']
//*[@data-field='author']
//*[@aria-label='小说标题']
```

**优点**：
- 最稳定，几乎不会变化
- 开发者专门设计用于测试
- 语义明确

**识别条件**：
- 包含 `data-testid`, `data-field`, `aria-label` 等属性
- 属性值有明确语义

#### 2. 稳定ID（置信度：92%）⭐⭐⭐⭐⭐

使用稳定的ID属性：

```xpath
//*[@id='novel-title']
//div[@id='book-info']//h1
```

**优点**：
- ID通常唯一
- 选择精确

**过滤规则**：
- 自动过滤动态ID（包含随机数字、UUID等）
- 过滤临时生成的ID

#### 3. 语义化Class（置信度：85%）⭐⭐⭐⭐

使用具有语义的CSS类名：

```xpath
//*[contains(@class, 'book-title')]
//*[contains(@class, 'author-name')]
//*[contains(@class, 'chapter-content')]
```

**优点**：
- 语义明确
- 开发者倾向于使用有意义的类名

**识别条件**：
- 类名包含 `title`, `author`, `content`, `info` 等关键词
- 过滤样式类（如 `col-`, `flex-`, `mt-` 等）

#### 4. 结构化路径（置信度：75-82%）⭐⭐⭐⭐

基于HTML结构和语义容器：

```xpath
//article//h1
//main//div[@class='content']//p
//section[@class='book-info']//span
```

**优点**：
- 利用HTML5语义标签
- 结构相对稳定

**识别条件**：
- 使用 `<article>`, `<main>`, `<section>` 等语义标签
- 结合语义化类名

#### 5. 属性组合（置信度：75-78%）⭐⭐⭐

组合多个稳定属性：

```xpath
//*[@class='title' and @role='heading']
//a[@class='chapter-link' and @target='_blank']
```

**优点**：
- 多个条件降低误选风险
- 更精确的定位

#### 6. 位置索引（置信度：65-85%）⭐⭐⭐

使用父级约束的位置索引：

```xpath
//div[@class='book-info']/h1[1]
//ul[@class='chapter-list']/li[2]/a
```

**优点**：
- 在结构稳定时很可靠
- 适合重复元素的选择

**缺点**：
- 结构变化时容易失效
- 需要配合稳定的父级元素

#### 7. 文本匹配（置信度：25%）⚠️

基于文本内容匹配（降级策略）：

```xpath
//*[contains(text(), '小说标题')]
//span[text()='作者名称']
```

**优点**：
- 总能生成一个XPath
- 适合固定文本内容

**缺点**：
- 文本变化时失效
- 仅作为最后的降级策略
- 会显示警告提示

---

## ⌨️ 快捷键参考

| 快捷键 | 功能 | 说明 |
|-------|------|------|
| `↑` | 向上选择父元素 | 选中父级元素 |
| `↓` | 向下选择子元素 | 返回到子元素 |
| `Esc` | 取消当前选择 | 清除选择状态 |
| `Enter` | 确认添加字段 | 添加当前字段 |
| `Space` | 测试当前XPath | 高亮显示匹配元素 |
| `1-9` | 快速选择XPath候选 | 选择对应序号的XPath |
| `Cmd/Ctrl + Z` | 撤销上一步操作 | 最多20步 |
| `Cmd/Ctrl + Shift + Z` | 重做 | 恢复撤销的操作 |
| `?` | 显示快捷键帮助 | 显示帮助面板 |

---

## 🎨 界面功能

### 主要区域

#### 1. URL输入区
- 输入目标网页URL
- 点击"开始渲染"按钮加载页面
- 显示渲染状态和进度

#### 2. 页面预览区（iframe）
- 显示真实网页
- 鼠标悬停高亮元素
- 点击选择元素
- 支持页面滚动和交互

#### 3. XPath候选列表
- 显示7种自动生成的XPath
- 置信度评分（彩色标签）
- 匹配元素数量
- 排序和过滤功能

#### 4. 字段管理区
- 已选择字段列表
- 字段类型和XPath预览
- 删除和编辑功能
- 批量导入按钮

### 置信度标签颜色

| 置信度 | 颜色 | 说明 |
|-------|------|------|
| 90%+ | 🟢 绿色 | 非常可靠，推荐使用 |
| 75-89% | 🔵 蓝色 | 可靠，可以使用 |
| 60-74% | 🟡 黄色 | 一般，需要测试 |
| 40-59% | 🟠 橙色 | 不太可靠，慎用 |
| <40% | 🔴 红色 | 不可靠，尽量避免 |

---

## 💡 使用技巧

### 1. 选择最佳XPath

**原则**：
- ✅ 优先选择置信度 90% 以上的
- ✅ 优先选择匹配数为1的（精确定位）
- ✅ 优先选择较短的XPath
- ❌ 避免使用文本匹配（25%置信度）

**示例**：

好的选择：
```xpath
//*[@data-testid='book-title']  # 置信度98%, 匹配1个
//*[@id='novel-title']          # 置信度92%, 匹配1个
```

避免使用：
```xpath
//*[contains(text(), '第一章')]  # 置信度25%, 文本会变化
//div[5]/div[2]/span[1]         # 没有语义，结构依赖强
```

### 2. 使用元素导航

当选中的元素不太合适时：

- 按 `↑` 向上选择父元素，寻找更稳定的容器
- 按 `↓` 向下返回子元素

**示例场景**：
```
点击了：<span class="txt">标题文本</span>
↑ 向上：<div class="book-title"><span>...</span></div>  # 更稳定
↑ 再向上：<article class="book-info">...</article>      # 语义化容器
```

### 3. 测试XPath

选择XPath后，按 `Space` 键测试：
- 系统会在页面上高亮所有匹配的元素
- 确认匹配数量是否符合预期
- 确认是否选中了正确的元素

### 4. 处理列表元素

对于章节列表、文章列表等重复元素：

1. **选择容器元素**：
   ```xpath
   //ul[@class='chapter-list']/li
   ```
   - 匹配数：100（所有章节）
   - 这是正确的！

2. **选择子元素使用相对路径**：
   ```xpath
   ./a/text()           # 相对路径提取标题
   ./a/@href            # 相对路径提取链接
   ```

### 5. 撤销误操作

如果选错了元素：
- 按 `Cmd/Ctrl + Z` 撤销
- 系统会恢复到上一个选择状态
- 支持连续撤销最多20步

---

## 🔧 高级功能

### 自动属性识别

系统会根据元素类型自动配置属性：

| 元素类型 | 自动配置 |
|---------|---------|
| `<a>` 链接 | 自动添加 `/@href` |
| `<img>` 图片 | 自动添加 `/@src` |
| `<input>` 输入框 | 自动添加 `/@value` |
| 普通文本元素 | 自动添加 `/text()` |

**示例**：
```html
<!-- 点击这个链接 -->
<a href="/chapter/1" class="chapter-link">第一章</a>

<!-- 自动生成 -->
XPath: //a[@class='chapter-link']/@href
属性: @href
```

### XPath排序功能

点击排序按钮，选择排序方式：

1. **按置信度排序**（默认）- 最可靠的在前
2. **按匹配数排序** - 匹配数少的在前（更精确）
3. **按XPath类型排序** - 按策略类型分组
4. **按长度排序** - 较短的在前（更简洁）

### 元素路径导航

面包屑导航显示当前元素的层级：

```
html > body > main > article > div.book-info > h1.title
```

点击任意层级可以快速跳转到该元素。

---

## 🐛 常见问题

### Q1: 页面渲染失败？

**可能原因**：
- 目标网站禁止iframe嵌入
- 网络连接问题
- Playwright未正确安装

**解决方案**：
1. 检查网络连接
2. 重新安装Playwright：`playwright install chromium`
3. 查看后端日志：`tail -f logs/backend.log`

### Q2: 点击元素没有反应？

**可能原因**：
- 元素被遮挡（如浮动广告）
- 元素在iframe外部

**解决方案**：
1. 滚动页面确保元素可见
2. 关闭页面上的弹窗或广告
3. 尝试点击元素的父级元素

### Q3: 生成的XPath置信度都很低？

**可能原因**：
- 页面使用了大量动态生成的类名
- HTML结构不够语义化

**解决方案**：
1. 尝试选择父级元素（按 `↑`）
2. 使用ID或其他稳定属性
3. 如果实在没有好的XPath，选择置信度最高的并测试

### Q4: XPath测试时匹配了多个元素？

**情况分析**：
- **如果是列表项**（如章节列表）：这是正确的！保持即可
- **如果不是列表**：需要选择更精确的XPath

**解决方案**：
1. 选择包含 `@id` 或 `@data-*` 属性的XPath
2. 使用位置索引：`//div[@class='title'][1]`
3. 重新选择，寻找更精确的元素

---

## 🎓 实战案例

### 案例1：配置小说网站

**目标网站**：`https://www.example.com/book/12345`

#### 1. 小说信息页配置

**步骤**：
1. 输入URL并渲染页面
2. 选择小说标题元素
   - XPath: `//*[@class='book-title']`
   - 置信度: 85%
3. 选择作者元素
   - XPath: `//*[@class='author-name']/text()`
   - 置信度: 85%
4. 选择封面图片
   - XPath: `//img[@class='book-cover']/@src`
   - 置信度: 92%
5. 批量导入字段

#### 2. 章节列表页配置

**步骤**：
1. 切换到章节列表页URL
2. 选择章节列表容器
   - XPath: `//ul[@class='chapter-list']/li`
   - 匹配: 100个元素（正确！）
3. 使用相对路径配置：
   - 标题: `./a/text()`
   - 链接: `./a/@href`

#### 3. 章节内容页配置

**步骤**：
1. 切换到任意章节URL
2. 选择章节标题
   - XPath: `//h1[@class='chapter-title']`
   - 置信度: 85%
3. 选择正文内容
   - XPath: `//div[@class='content']//p`
   - 匹配: 多个段落（正确！）

---

## 🚀 性能优化

### 提升配置效率的技巧

1. **使用快捷键** - 熟练使用快捷键可提升50%效率
2. **批量选择** - 一次性选择所有字段再导入
3. **善用撤销** - 不用担心选错，大胆尝试
4. **测试XPath** - 选择后立即测试，避免后期返工
5. **学习XPath模式** - 了解常见的XPath模式可快速识别

---

## 📚 相关文档

- [流程编辑器](flow-editor.md) - 另一种配置方式
- [智能配置向导](config-wizard.md) - 传统配置方式
- [使用示例](../user-guides/usage-examples.md) - 更多实战案例
- [快捷键参考](../user-guides/shortcuts.md) - 完整快捷键列表

---

**返回**: [文档中心](../README.md) | **下一篇**: [流程编辑器](flow-editor.md)

