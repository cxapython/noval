# 🧙 智能配置向导

智能配置向导提供可视化的配置流程，帮助你快速识别页面元素并生成爬虫配置。

## 🌟 功能特性

- ✅ 向导式配置流程
- ✅ 智能字段识别
- ✅ 页面渲染预览
- ✅ CSS选择器转XPath
- ✅ 配置实时测试
- ✅ 一键导出配置

---

## 🚀 使用流程

### 步骤1：启动向导

在爬虫管理页面点击"智能向导"按钮。

### 步骤2：基本信息

填写网站基本信息：

**必填项**：
- **网站名称** - 例如：示例小说网
- **基础URL** - 例如：https://www.example.com
- **内容类型** - 选择：小说/新闻/文章/博客

**可选项**：
- **网站描述** - 简要说明
- **URL模板** - 例如：https://www.example.com/book/{novel_id}

点击"下一步"继续。

### 步骤3：页面类型选择

选择要配置的页面类型：

1. **信息页** - 配置基本信息（标题、作者等）
2. **列表页** - 配置章节列表
3. **内容页** - 配置章节正文

选择后输入示例URL并点击"渲染页面"。

### 步骤4：页面渲染

**渲染过程**：
1. 系统使用Playwright加载页面
2. 截取页面预览图
3. 分析页面结构
4. 准备字段识别

**注意**：
- 渲染可能需要10-30秒
- 确保URL可访问
- 某些网站可能禁止渲染

### 步骤5：字段识别

#### 5.1 获取CSS选择器

**方式1：浏览器开发者工具**
1. 按 `F12` 打开开发者工具
2. 点击元素选择器（左上角箭头图标）
3. 点击页面上的目标元素
4. 右键元素 → Copy → Copy selector
5. 粘贴到向导中

**方式2：手动编写**
```css
/* 标题 */
h1.book-title

/* 作者 */
span.author-name

/* 封面 */
img.book-cover
```

#### 5.2 生成XPath

点击"生成XPath"按钮：

**生成结果**：
- 系统提供5-7种XPath候选
- 每种都有置信度评分
- 显示预计匹配数量

**选择XPath**：
1. 查看每个XPath的置信度
2. 优先选择90%以上的
3. 点击选择合适的XPath

#### 5.3 配置字段属性

**字段类型**：
根据内容类型显示对应字段：

**小说类型**：
- 小说标题
- 作者
- 封面图片
- 简介
- 状态
- 分类

**新闻类型**：
- 新闻标题
- 作者
- 发布时间
- 新闻内容

**文章类型**：
- 文章标题
- 作者
- 发布时间
- 文章内容

**博客类型**：
- 博客标题
- 作者
- 发布时间
- 博客内容

#### 5.4 添加字段

1. 选择字段类型
2. 确认XPath表达式
3. 点击"添加字段"
4. 字段加入列表

#### 5.5 重复识别

重复步骤5.1-5.4，识别所有需要的字段。

### 步骤6：测试配置

**测试功能**：
1. 点击"测试配置"按钮
2. 系统实时抓取和解析
3. 显示每个字段的提取结果

**测试结果**：
```
✅ 小说标题: "我的小说"
✅ 作者: "作者名"
✅ 封面图片: "https://example.com/cover.jpg"
❌ 简介: 提取失败
```

**调整配置**：
- 提取失败的字段需要重新识别
- 可以修改XPath表达式
- 添加后处理规则

### 步骤7：导出配置

1. 所有字段识别完成
2. 测试通过
3. 点击"导出配置"
4. 配置自动填充到编辑器
5. 保存配置

---

## 💡 CSS选择器示例

### 常见选择器

#### 1. 类选择器
```css
.book-title          /* 单个类 */
.book-info .title    /* 嵌套类 */
```

#### 2. ID选择器
```css
#novel-title         /* ID选择器 */
#content #chapter    /* 嵌套ID */
```

#### 3. 属性选择器
```css
[data-type="title"]                 /* 属性存在 */
img[class="cover"]                  /* 标签+属性 */
a[href^="/chapter"]                 /* 属性开头 */
```

#### 4. 组合选择器
```css
div.book-info > h1                  /* 直接子元素 */
article .content p                  /* 后代元素 */
ul.chapters li:first-child          /* 首个元素 */
```

### 实战示例

#### 示例1：提取小说标题

**HTML**：
```html
<div class="book-info">
  <h1 class="book-title">我的小说</h1>
</div>
```

**CSS选择器**：
```css
.book-info .book-title
```

**生成的XPath**：
```xpath
//div[@class='book-info']//h1[@class='book-title']/text()
```

#### 示例2：提取作者

**HTML**：
```html
<span class="author-name">作者名</span>
```

**CSS选择器**：
```css
.author-name
```

**生成的XPath**：
```xpath
//span[@class='author-name']/text()
```

#### 示例3：提取封面

**HTML**：
```html
<img src="/cover.jpg" class="book-cover" alt="封面">
```

**CSS选择器**：
```css
img.book-cover
```

**生成的XPath**：
```xpath
//img[@class='book-cover']/@src
```

#### 示例4：提取章节列表

**HTML**：
```html
<ul class="chapter-list">
  <li><a href="/chapter/1">第一章</a></li>
  <li><a href="/chapter/2">第二章</a></li>
</ul>
```

**CSS选择器**：
```css
ul.chapter-list li
```

**生成的XPath**：
```xpath
//ul[@class='chapter-list']/li
```

---

## 🔧 高级技巧

### 1. 处理动态类名

**问题**：
```html
<div class="book_title_a8f9d3">标题</div>
```

**解决**：
使用部分匹配：
```css
[class*="book_title"]
```

### 2. 处理多个相同类

**问题**：
页面有多个相同类的元素

**解决**：
添加更多层级：
```css
div.book-info > div.main > h1.title
```

### 3. 使用伪类选择器

**示例**：
```css
ul li:first-child        /* 第一个 */
ul li:last-child         /* 最后一个 */
ul li:nth-child(2)       /* 第二个 */
```

### 4. 组合多个选择器

**示例**：
```css
.title, .book-title, h1.title    /* 或关系 */
```

---

## 📊 XPath生成策略

向导使用多种策略生成XPath：

### 1. 直接转换（80%置信度）
```css
.book-title
↓
//[@class='book-title']
```

### 2. 语义化增强（90%置信度）
```css
h1.title
↓
//h1[contains(@class, 'title')]/text()
```

### 3. 属性组合（85%置信度）
```css
[data-type="title"]
↓
//*[@data-type='title']/text()
```

### 4. 结构路径（75%置信度）
```css
div.info > h1
↓
//div[@class='info']/h1/text()
```

---

## 🐛 常见问题

### Q1: CSS选择器无法转换为XPath？

**原因**：
- CSS选择器语法错误
- 包含不支持的伪类
- 选择器过于复杂

**解决**：
1. 简化选择器
2. 使用基本选择器
3. 手动编写XPath

### Q2: 生成的XPath提取结果为空？

**原因**：
- XPath表达式不正确
- 元素是动态加载的
- 页面结构变化

**解决**：
1. 使用可视化选择器重新生成
2. 检查页面源代码
3. 尝试其他XPath候选

### Q3: 页面渲染失败？

**原因**：
- 网站禁止iframe嵌入
- 需要登录
- 网络问题

**解决**：
1. 检查URL是否正确
2. 尝试使用浏览器直接访问
3. 使用可视化选择器（支持更多网站）

### Q4: 向导卡在某个步骤？

**解决**：
1. 刷新页面重新开始
2. 清除浏览器缓存
3. 检查浏览器控制台错误

---

## 💡 最佳实践

### 1. 选择稳定的选择器

**好的选择器**：
```css
.book-title              /* 语义化类名 */
#novel-info             /* 稳定ID */
[data-testid="title"]   /* 测试属性 */
```

**避免的选择器**：
```css
div:nth-child(5)                    /* 位置依赖 */
.css-a8f9d3                         /* 动态类名 */
div > div > div > span              /* 过度嵌套 */
```

### 2. 测试多个示例

- 使用不同的小说ID测试
- 检查不同页面的兼容性
- 验证边缘情况

### 3. 添加后处理规则

即使XPath正确，也可能需要清洗：
- 去除空格
- 移除前缀/后缀
- 提取特定格式

### 4. 记录配置说明

在描述字段中注明：
- 网站特点
- 注意事项
- 更新历史

---

## 🆚 与其他方式对比

| 特性 | 智能向导 | 可视化选择器 | 手动JSON |
|-----|---------|------------|---------|
| 易用性 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 效率 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 灵活性 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 学习成本 | ⭐⭐ | ⭐ | ⭐⭐⭐⭐ |

**建议**：
- 新手：优先使用可视化选择器
- 熟悉CSS：可以使用智能向导
- 高级用户：直接编辑JSON

---

## 📚 相关文档

- [可视化元素选择器](visual-selector.md) - 更强大的配置方式
- [流程编辑器](flow-editor.md) - 零代码配置
- [爬虫配置管理](crawler-manager.md) - 配置管理

---

**返回**: [文档中心](../README.md) | **上一篇**: [小说阅读器](novel-reader.md)

