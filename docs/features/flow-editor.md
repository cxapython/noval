# 🎨 可视化流程编辑器

> v3.0.0 核心功能 | 零代码配置 | 拖拽式操作 | 插件化架构

可视化流程编辑器让你通过拖拽节点的方式配置爬虫规则，无需编写任何代码即可创建复杂的数据提取和清洗流程。

## 🌟 核心优势

### 为什么使用流程编辑器？

- 🎯 **零代码配置** - 无需编写任何代码
- 🔌 **插件化架构** - 灵活的处理器系统
- 🎨 **可视化操作** - 拖拽连接节点
- 🔄 **双向转换** - 流程图 ↔ JSON配置
- 📏 **节点调整** - 可调整节点大小
- 💾 **实时保存** - 自动生成标准配置
- 📖 **易于理解** - 清晰的数据流向

---

## 🧩 节点类型

### 提取器节点

#### 1. XPath提取器 📍

使用XPath表达式从HTML中提取数据。

**配置项**：
- **XPath表达式** - 例如：`//h1[@class='title']/text()`
- **提取类型** - 文本内容或属性值

**示例**：
```xpath
// 提取标题文本
//h1[@class='book-title']/text()

// 提取链接地址
//a[@class='chapter-link']/@href

// 提取图片URL
//img[@class='cover']/@src
```

**适用场景**：
- 提取标题、作者、内容等文本
- 提取链接、图片等属性
- 提取列表项（章节列表等）

#### 2. 正则提取器 🔍

使用正则表达式从文本中提取数据。

**配置项**：
- **正则表达式** - 例如：`章节(\d+)`
- **提取组** - 默认组0（整个匹配）

**示例**：
```regex
// 提取章节编号
第(\d+)章

// 提取日期
(\d{4}-\d{2}-\d{2})

// 提取数字
\d+
```

**适用场景**：
- 从文本中提取特定格式的数据
- 提取数字、日期等结构化信息
- 复杂的文本解析

---

### 处理器节点

#### 1. 索引选择器 🎯

从数组中提取指定位置的元素。

**配置项**：
- **索引值**：
  - `-1` - 最后一个元素
  - `0` - 第一个元素
  - `999` - 所有元素（返回完整数组）
  - 其他数字 - 指定位置的元素

**示例**：
```
输入: ["第一章", "第二章", "第三章"]
索引 0  → "第一章"
索引 -1 → "第三章"
索引 999 → ["第一章", "第二章", "第三章"]
```

**适用场景**：
- XPath匹配了多个元素，只需要其中一个
- 提取最后一页的链接（索引-1）
- 保留所有匹配结果（索引999）

#### 2. 去除空格 🧹

去除字符串首尾的空白字符。

**功能**：
- 去除空格、制表符、换行符
- 支持字符串和数组

**示例**：
```
输入: "  小说标题  \n"
输出: "小说标题"

输入: ["  章节1  ", "  章节2  "]
输出: ["章节1", "章节2"]
```

**适用场景**：
- 清理提取的文本数据
- 去除HTML中的多余空白

#### 3. 字符替换 🔄

将指定字符串替换为新内容。

**配置项**：
- **查找文本** - 要替换的字符串
- **替换为** - 新的字符串

**示例**：
```
// 移除前缀
查找: "章节："
替换: ""
输入: "章节：第一章"
输出: "第一章"

// 替换域名
查找: "//www.old.com"
替换: "//www.new.com"
```

**适用场景**：
- 移除固定的前缀或后缀
- 替换特定字符串
- 清理不需要的内容

#### 4. 正则替换 🔍

使用正则表达式进行模式匹配和替换。

**配置项**：
- **正则表达式** - 匹配模式
- **替换为** - 替换内容
- **标志** - g（全局）、i（忽略大小写）

**示例**：
```regex
// 去除所有数字
pattern: \d+
replace: ""

// 去除广告文本
pattern: .*广告.*
replace: ""

// 标准化空白
pattern: \s+
replace: " "
```

**适用场景**：
- 去除广告或版权信息
- 清理格式字符
- 复杂的文本替换

#### 5. 合并数组 📦

将数组元素用指定分隔符连接成字符串。

**配置项**：
- **分隔符** - 默认为空字符串
- 常用：`\n`（换行）、` `（空格）、`,`（逗号）

**示例**：
```
输入: ["段落1", "段落2", "段落3"]
分隔符: "\n"
输出: "段落1\n段落2\n段落3"
```

**适用场景**：
- 合并多个段落成为完整正文
- 将数组转换为字符串
- 格式化输出

#### 6. 分割字符串 ✂️

将字符串按分隔符分割成数组。

**配置项**：
- **分隔符** - 用于分割的字符
- 常用：`,`（逗号）、`\n`（换行）、` `（空格）

**示例**：
```
输入: "标签1,标签2,标签3"
分隔符: ","
输出: ["标签1", "标签2", "标签3"]
```

**适用场景**：
- 解析标签字符串
- 处理CSV数据
- 拆分复合字段

#### 7. 提取第一个 👆

从数组中提取第一个非空元素。

**功能**：
- 自动跳过空字符串
- 返回第一个有效值

**示例**：
```
输入: ["", "", "有效内容", "其他内容"]
输出: "有效内容"
```

**适用场景**：
- 多个候选值，取第一个有效的
- 处理可选字段

---

## 🚀 使用流程

### 步骤1：选择页面类型

在流程编辑器标签页，选择要配置的页面类型：

- **小说信息页** - 配置标题、作者、封面等
- **章节列表页** - 配置章节链接列表
- **章节内容页** - 配置章节标题和正文

### 步骤2：选择要配置的字段

选择具体的字段，例如：
- 小说标题
- 作者
- 封面图片
- 章节标题
- 正文内容

### 步骤3：构建处理流程

#### 3.1 拖拽节点到画布

从左侧节点面板拖拽需要的节点：

1. **提取器节点**（必须）
   - XPath提取器或正则提取器
   - 作为流程的起点

2. **处理器节点**（可选）
   - 根据需要添加清洗和转换节点
   - 可以添加多个处理器串联

#### 3.2 配置节点参数

点击节点，在右侧面板配置：

**XPath提取器示例**：
```
XPath表达式: //h1[@class='title']/text()
提取类型: 文本内容
```

**索引选择器示例**：
```
索引值: -1  (最后一个元素)
```

**字符替换示例**：
```
查找文本: "正文："
替换为: ""
```

#### 3.3 连接节点

从节点右侧的连接点拖动到下一个节点的左侧：

```
[XPath提取器] ──→ [索引选择器] ──→ [去除空格] ──→ [字符替换]
```

**注意**：
- 提取器节点只有输出（右侧连接点）
- 处理器节点有输入和输出（左右连接点）
- 必须按顺序连接

### 步骤4：生成配置

1. 点击"生成配置"按钮
2. 在弹出的对话框中填写：
   - 网站名称
   - 基础URL
   - 网站描述
3. 点击"确认"
4. 配置会自动应用到表单

### 步骤5：保存配置

点击"保存配置"按钮保存。

---

## 💡 实战案例

### 案例1：提取小说标题

**需求**：从页面中提取小说标题，去除空格和前缀

**流程设计**：
```
XPath提取器 → 索引选择器 → 去除空格 → 字符替换
```

**节点配置**：

1. **XPath提取器**
   ```
   XPath: //h1[@class='book-title']/text()
   ```
   输出: ["  书名：我的小说  "]

2. **索引选择器**
   ```
   索引: -1  (取最后一个)
   ```
   输出: "  书名：我的小说  "

3. **去除空格**
   ```
   无需配置
   ```
   输出: "书名：我的小说"

4. **字符替换**
   ```
   查找: "书名："
   替换: ""
   ```
   输出: "我的小说"

### 案例2：提取章节内容

**需求**：提取所有段落，合并成完整正文，去除广告

**流程设计**：
```
XPath提取器 → 索引选择器(999) → 正则替换 → 合并数组
```

**节点配置**：

1. **XPath提取器**
   ```
   XPath: //div[@class='content']//p/text()
   ```
   输出: ["段落1", "广告内容", "段落2", "段落3"]

2. **索引选择器**
   ```
   索引: 999  (保留所有)
   ```
   输出: ["段落1", "广告内容", "段落2", "段落3"]

3. **正则替换**
   ```
   正则: .*广告.*
   替换: ""
   ```
   输出: ["段落1", "", "段落2", "段落3"]

4. **合并数组**
   ```
   分隔符: \n
   ```
   输出: "段落1\n\n段落2\n段落3"

### 案例3：提取章节列表

**需求**：提取所有章节的标题和链接

**两个并行流程**：

**流程A - 提取标题**：
```
XPath提取器 → 索引选择器(999) → 去除空格
```

**流程B - 提取链接**：
```
XPath提取器 → 索引选择器(999)
```

**节点配置**：

**流程A - 标题**：
1. XPath提取器
   ```
   XPath: //ul[@class='chapter-list']/li/a/text()
   ```

2. 索引选择器
   ```
   索引: 999
   ```

3. 去除空格

**流程B - 链接**：
1. XPath提取器
   ```
   XPath: //ul[@class='chapter-list']/li/a/@href
   ```

2. 索引选择器
   ```
   索引: 999
   ```

---

## 🔧 高级技巧

### 1. 节点复用

如果多个字段的处理流程相似：
1. 配置好一个字段的流程
2. 生成配置后切换到其他字段
3. 修改提取器的XPath
4. 保持后续处理器不变

### 2. 调试流程

在构建流程时：
1. 先添加提取器，查看原始数据
2. 逐个添加处理器
3. 每次添加后生成配置并测试
4. 确认数据符合预期

### 3. 优化性能

- 尽量减少处理器数量
- 使用正则替换代替多个字符替换
- 合理使用索引选择器

### 4. 处理边缘情况

- 使用提取第一个处理器处理可选字段
- 使用正则替换去除不确定的噪声
- 测试多个样本页面

---

## 🐛 常见问题

### Q1: 节点连接不上？

**原因**：
- 从输入点连到了输入点
- 从输出点连到了输出点

**解决**：
- 从右侧（输出）拖到左侧（输入）
- 提取器只有输出（右侧）
- 处理器有输入（左侧）和输出（右侧）

### Q2: 生成配置失败？

**检查**：
- [ ] 是否有提取器节点？
- [ ] 节点是否已连接？
- [ ] 节点参数是否填写完整？
- [ ] 流程是否有断点？

### Q3: 配置测试结果不对？

**排查**：
1. 检查XPath是否正确
2. 逐个节点验证数据
3. 查看是否需要索引选择器
4. 确认处理器参数正确

### Q4: 索引选择器用哪个值？

**选择指南**：
- `-1` - 只需要最后一个元素时（如：最新章节）
- `0` - 只需要第一个元素时（如：第一章）
- `999` - 需要所有元素时（如：章节列表、段落列表）
- 其他 - 需要特定位置的元素

---

## 📚 节点参考

### 快速查询表

| 节点名称 | 类型 | 输入 | 输出 | 用途 |
|---------|------|------|------|------|
| XPath提取器 | 提取器 | - | 字符串/数组 | 从HTML提取数据 |
| 正则提取器 | 提取器 | - | 字符串/数组 | 从文本提取数据 |
| 索引选择器 | 处理器 | 数组 | 字符串/数组 | 选择特定元素 |
| 去除空格 | 处理器 | 字符串/数组 | 字符串/数组 | 清理空白字符 |
| 字符替换 | 处理器 | 字符串/数组 | 字符串/数组 | 替换固定文本 |
| 正则替换 | 处理器 | 字符串/数组 | 字符串/数组 | 正则匹配替换 |
| 合并数组 | 处理器 | 数组 | 字符串 | 数组转字符串 |
| 分割字符串 | 处理器 | 字符串 | 数组 | 字符串转数组 |
| 提取第一个 | 处理器 | 数组 | 字符串 | 取首个非空值 |

---

## 🎓 学习路径

### 新手
1. 从简单字段开始（标题、作者）
2. 使用基本流程：提取器 → 索引选择器 → 去除空格
3. 逐步添加更多处理器

### 进阶
1. 使用正则替换去除复杂内容
2. 组合多个处理器处理复杂数据
3. 处理列表和数组数据

### 高级
1. 设计可复用的流程模式
2. 优化处理器组合
3. 处理边缘情况和异常数据

---

## 📚 相关文档

- [可视化元素选择器](visual-selector.md) - 自动生成XPath
- [智能配置向导](config-wizard.md) - 传统配置方式
- [使用示例](../user-guides/usage-examples.md) - 更多实战案例

---

**返回**: [文档中心](../README.md) | **上一篇**: [可视化元素选择器](visual-selector.md) | **下一篇**: [爬虫配置管理](crawler-manager.md)

