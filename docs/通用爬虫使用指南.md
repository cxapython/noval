# é€šç”¨çˆ¬è™«ä½¿ç”¨æŒ‡å—

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶

### 1. `backend/generic_crawler.py` - ç”Ÿäº§ç¯å¢ƒçˆ¬è™«
**ç”¨é€”**ï¼šæ­£å¼çˆ¬å–ä»»åŠ¡ä½¿ç”¨
**ç‰¹ç‚¹**ï¼š
- æ¨¡å—åŒ–è®¾è®¡ï¼ˆé…ç½®ç®¡ç†ã€HTMLè§£æã€HTTPè¯·æ±‚åˆ†ç¦»ï¼‰
- æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘
- Redisç¼“å­˜ï¼ˆé¿å…é‡å¤ä¸‹è½½ï¼‰
- è¿›åº¦å›è°ƒå’Œæ—¥å¿—å›è°ƒ
- æ”¯æŒä»£ç†

### 2. `backend/generic_crawler_debug.py` - PyCharmè°ƒè¯•å·¥å…·
**ç”¨é€”**ï¼šåœ¨ PyCharm ä¸­æµ‹è¯•å’Œè°ƒè¯•é…ç½®æ–‡ä»¶
**ç‰¹ç‚¹**ï¼š
- ç»§æ‰¿è‡ª `GenericNovelCrawler`ï¼Œæ·»åŠ è°ƒè¯•ä¿¡æ¯
- è¯¦ç»†æ˜¾ç¤ºæ¯ä¸ªè§£ææ­¥éª¤
- æ˜¾ç¤ºåŒ¹é…çŠ¶æ€å’Œä¸Šä¸‹æ–‡
- ç›´æ¥ä¿®æ”¹é…ç½®å‚æ•°ï¼Œæ— éœ€å‘½ä»¤è¡Œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç”Ÿäº§ä½¿ç”¨

```python
from backend.generic_crawler import GenericNovelCrawler

crawler = GenericNovelCrawler(
    config_file="configs/config_ikbook8.json",
    book_id="10683",
    max_workers=5,
    use_proxy=False
)

crawler.run()
```

### PyCharm è°ƒè¯•

1. **æ‰“å¼€æ–‡ä»¶**ï¼š`backend/generic_crawler_debug.py`

2. **ä¿®æ”¹é…ç½®**ï¼ˆæ–‡ä»¶æœ«å°¾ï¼‰ï¼š
```python
CONFIG_FILE = project_root / "configs" / "config_ikbook8.json"
BOOK_ID = "10683"
TEST_CHAPTER_INDEX = 0
```

3. **è¿è¡Œæˆ–è°ƒè¯•**ï¼šå³é”® â†’ Run/Debug

## ğŸ” è°ƒè¯•å·¥å…·ç‰¹æ€§

### è¾“å‡ºå†…å®¹

#### 1. å°è¯´ä¿¡æ¯è§£æ
```
ğŸ“Š è§£æç»“æœ:
  title: ã€Šæ´ªè’ï¼šæˆ‘çš„è€å©†æ˜¯ååœŸã€‹
  author: è¥¿æ¸¸å‘å¾€

ğŸ” è°ƒè¯•è¯¦æƒ…:
  å­—æ®µ: author
    åŸå§‹å€¼: ä½œ  è€…ï¼šè¥¿æ¸¸å‘å¾€
    æœ€ç»ˆå€¼: è¥¿æ¸¸å‘å¾€
    åå¤„ç†æ­¥éª¤:
      æ­¥éª¤1: replace
        åŒ¹é…: âœ…
        å˜åŒ–: æ˜¯
```

#### 2. ç« èŠ‚åˆ—è¡¨è§£æ
```
âœ… è§£ææˆåŠŸï¼Œå…± 47 ç« 

å‰5ç« é¢„è§ˆ:
  1. ç¬¬ä¸€ç«  æˆ‘çš„è€å©†æ˜¯ååœŸ
     URL: https://...
```

#### 3. ç« èŠ‚å†…å®¹è§£æ
```
ğŸ“Š å†…å®¹ç»Ÿè®¡:
  å¤„ç†é¡µæ•°: 2
  åŸå§‹é•¿åº¦: 3000 å­—
  æœ€ç»ˆé•¿åº¦: 2842 å­—

ğŸ§¹ æ¸…ç†æ­¥éª¤:
  è§„åˆ™1: replace
    åŒ¹é…: âœ… (ç²¾ç¡®åŒ¹é…)
    å˜åŒ–: âœ…
    åŒ¹é…ä¸Šä¸‹æ–‡:
      æ›¿æ¢å‰: ...å¹¿å‘Šå†…å®¹...
      æ›¿æ¢å: ......
```

### åŒ¹é…çŠ¶æ€è¯´æ˜

- **âœ… ç²¾ç¡®åŒ¹é…**ï¼šç›´æ¥æ‰¾åˆ°å¹¶æ›¿æ¢
- **âœ… æ™ºèƒ½åŒ¹é…**ï¼šé€šè¿‡ç©ºæ ¼æ ‡å‡†åŒ–ååŒ¹é…
- **âŒ æœªåŒ¹é…**ï¼šæ²¡æœ‰æ‰¾åˆ°è¦æ›¿æ¢çš„å†…å®¹

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
{
  "site_info": {
    "name": "ikbook8",
    "base_url": "https://m.ikbook8.com"
  },
  "url_patterns": {
    "book_detail": "/book/{0}.html"
  },
  "parsers": {
    "novel_info": {
      "title": {
        "type": "xpath",
        "expression": "//div[@class='info']//p[1]/text()",
        "index": 0
      },
      "author": {
        "type": "xpath",
        "expression": "//div[@class='info']//p[1]/text()",
        "index": -1,
        "process": [
          {
            "method": "replace",
            "params": {"old": "ä½œ  è€…ï¼š", "new": ""}
          }
        ]
      }
    },
    "chapter_list": {
      "items": {
        "type": "xpath",
        "expression": "//div[@class='section-box'][last()]/ul/li"
      },
      "title": {
        "type": "xpath",
        "expression": "./a/text()"
      },
      "url": {
        "type": "xpath",
        "expression": "./a/@href"
      }
    },
    "chapter_content": {
      "content": {
        "type": "xpath",
        "expression": "//div[@class='content'][last()]//text()",
        "index": 999,
        "process": [
          {
            "method": "join",
            "params": {"separator": "\n"}
          }
        ]
      },
      "clean": [
        {
          "method": "replace",
          "params": {"old": "å¹¿å‘Šå†…å®¹", "new": ""}
        }
      ]
    }
  }
}
```

## ğŸ› ï¸ æ”¯æŒçš„åå¤„ç†æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|
| `strip` | å»é™¤é¦–å°¾ç©ºç™½ | `chars`: è¦å»é™¤çš„å­—ç¬¦ |
| `replace` | å­—ç¬¦ä¸²æ›¿æ¢ | `old`, `new` |
| `regex_replace` | æ­£åˆ™æ›¿æ¢ | `pattern`, `repl` |
| `join` | è¿æ¥åˆ—è¡¨ | `separator` |
| `split` | åˆ†å‰²å­—ç¬¦ä¸² | `separator` |
| `extract_first` | æå–ç¬¬ä¸€ä¸ªå…ƒç´  | æ—  |
| `extract_index` | æå–æŒ‡å®šç´¢å¼• | `index` |

## ğŸ› å¸¸è§é—®é¢˜

### Q: å†…å®¹ä¸ºç©ºï¼Ÿ
**åŸå› **ï¼šXPathè¡¨è¾¾å¼ä¸åŒ¹é…
**è§£å†³**ï¼š
1. è¿è¡Œ `generic_crawler_debug.py`
2. æŸ¥çœ‹"åŒ¹é…"çŠ¶æ€
3. å¦‚æœæ˜¾ç¤º âŒï¼Œè°ƒæ•´é…ç½®æ–‡ä»¶ä¸­çš„XPath

### Q: æ¸…ç†è§„åˆ™ä¸ç”Ÿæ•ˆï¼Ÿ
**åŸå› **ï¼šæ²¡æœ‰æ‰¾åˆ°è¦æ›¿æ¢çš„å†…å®¹
**è§£å†³**ï¼š
1. æŸ¥çœ‹"åŒ¹é…ä¸Šä¸‹æ–‡"
2. ç¡®è®¤ `old` å‚æ•°ä¸å®é™…å†…å®¹ä¸€è‡´
3. æ³¨æ„ç©ºæ ¼ç±»å‹ï¼ˆæ™®é€šç©ºæ ¼ vs `\xa0`ï¼‰

### Q: å¦‚ä½•æµ‹è¯•ç‰¹å®šç« èŠ‚ï¼Ÿ
**æ–¹æ³•**ï¼š
```python
# åœ¨ generic_crawler_debug.py ä¸­ä¿®æ”¹
TEST_CHAPTER_INDEX = 9  # æµ‹è¯•ç¬¬10ç« 
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å…ˆè°ƒè¯•åéƒ¨ç½²**ï¼š
   - ä½¿ç”¨ `generic_crawler_debug.py` æµ‹è¯•é…ç½®
   - ç¡®è®¤æ‰€æœ‰è§£ææ­£ç¡®åå†æ­£å¼çˆ¬å–

2. **åˆç†è®¾ç½®å¹¶å‘**ï¼š
   - è°ƒè¯•æ—¶ï¼š`MAX_WORKERS = 1`
   - æ­£å¼çˆ¬å–ï¼šæ ¹æ®ç½‘ç«™æƒ…å†µè°ƒæ•´ï¼ˆå»ºè®®3-10ï¼‰

3. **ä½¿ç”¨ä»£ç†**ï¼š
   - å¤§é‡çˆ¬å–æ—¶å¯ç”¨ä»£ç†é¿å…IPå°ç¦
   - `use_proxy=True`

4. **ç›‘æ§Redisç»Ÿè®¡**ï¼š
   - å®šæœŸæ£€æŸ¥æˆåŠŸ/å¤±è´¥ç« èŠ‚æ•°
   - å¤±è´¥ç« èŠ‚å¯ä»¥é‡è¯•

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
backend/
  â”œâ”€â”€ generic_crawler.py         # æ ¸å¿ƒçˆ¬è™«
  â”œâ”€â”€ generic_crawler_debug.py   # è°ƒè¯•å·¥å…·
  â”œâ”€â”€ config_manager.py           # é…ç½®ç®¡ç†
  â”œâ”€â”€ parser.py                   # HTMLè§£æ
  â””â”€â”€ content_fetcher.py          # HTTPè¯·æ±‚

configs/
  â”œâ”€â”€ config_template.json        # é…ç½®æ¨¡æ¿
  â””â”€â”€ config_*.json               # å„ç½‘ç«™é…ç½®

docs/
  â”œâ”€â”€ é€šç”¨çˆ¬è™«ä½¿ç”¨æŒ‡å—.md         # æœ¬æ–‡æ¡£
  â””â”€â”€ è°ƒè¯•å·¥å…·ä½¿ç”¨.md             # å¿«é€Ÿå‚è€ƒ
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è°ƒè¯•å·¥å…·å¿«é€Ÿå‚è€ƒ](./è°ƒè¯•å·¥å…·ä½¿ç”¨.md)
- [é…ç½®æ–‡ä»¶æ¨¡æ¿](../configs/config_template.json)

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-05  
**ç‰ˆæœ¬**: 2.0

