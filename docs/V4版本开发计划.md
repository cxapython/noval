# V4 版本开发计划

**版本号**: v4.0.0  
**代号**: Mantine UI Modernization  
**开发分支**: `feature/ui-migration-mantine`  
**开始日期**: 2025-10-07  
**预计完成**: 2025-10-17 (10个工作日)

---

## 🎯 版本目标

### 核心目标
1. **UI框架现代化** - 从Ant Design 5.x迁移到Mantine 7.x
2. **视觉体验提升** - 采用现代设计语言，提升用户体验
3. **代码质量优化** - 精简代码，移除冗余功能
4. **维护成本降低** - 更易定制的UI框架，降低长期维护成本

### 技术指标
- ✅ Bundle Size：减少 ~200KB
- ✅ 首屏加载：< 2s
- ✅ 代码行数：减少 ~2400行（已完成）
- ✅ 迁移时间：9.5天（比原方案节省30%）

---

## 📦 V3 → V4 主要变更

### 已完成的准备工作 ✅

#### 1. 功能精简（减少1897行代码）
```diff
- 移除表单视图 (FormView) - 400行
- 移除配置测试Tab (TestView) - 250行  
- 移除代码编辑器 (CodeEditor) - 200行
- 移除7个业务文档 - 2591行

✅ ConfigEditorPage.jsx: 1645行 → 289行 (减少82%)
✅ CrawlerManager.jsx: 394行 → 320行 (减少18%)
```

#### 2. 文档完善
```
✅ RFC-前端UI框架迁移方案.md (23KB) - 框架选型分析
✅ RFC-Mantine迁移技术方案.md (24KB) - 技术实施方案
✅ 前端迁移-功能精简方案.md (6.8KB) - 功能精简决策
✅ UI迁移工作总结.md (6.2KB) - 工作总结
✅ docs/README.md - 文档导航
```

#### 3. Git仓库准备
```bash
✅ main分支已更新到远程
✅ feature/ui-migration-mantine分支已创建并推送
✅ 所有准备工作已提交
```

### 待实施的迁移工作 ⏳

#### Phase 1: 环境准备 (0.5天) ✅
```
[x] 安装Mantine依赖
[x] 创建主题配置 (src/theme.js)
[x] 配置MantineProvider
[x] 验证环境正常
```

#### Phase 2: 公共组件 (2天) ✅
```
[x] Layout.jsx - 布局框架
[x] PostProcessRuleEditor.jsx - 清洗规则编辑器
[x] PaginationConfigForm.jsx - 分页配置表单
```

#### Phase 3: 核心页面 (4.5天) ✅
```
[x] CrawlerManager.jsx (1天) - 爬虫管理列表
[x] ConfigWizard.jsx (2.5天) - 智能向导
[x] ConfigEditorPage.jsx (1天) - 配置编辑器
```

#### Phase 4: 流程编辑器 (1.5天) ⏸️
```
[ ] SimpleFlowEditorTab.jsx - 流程编辑器主界面
[ ] NodePalette.jsx - 节点面板
[ ] 自定义节点组件 - XPath/Processor/Regex节点
```

#### Phase 5: 任务管理 (1.5天) ⏸️
```
[ ] TaskManagerPage.jsx - 任务列表和监控
```

#### Phase 6: 优化测试 (1天) ⏸️
```
[ ] 主题优化和细节调整
[ ] 全流程功能测试
[ ] 性能优化
[ ] 文档更新
```

---

## 🔄 从V3迁移到V4

### 保留的核心功能
✅ **爬虫配置**
- 智能向导（配置生成）
- 流程配置（可视化编辑）
- JSON视图（直接编辑）

✅ **爬虫管理**
- 配置列表展示
- 运行爬虫
- 编辑/删除配置

✅ **任务管理**
- 任务列表
- 进度监控
- 日志查看

✅ **小说阅读器**（延后到Phase 3）
- 章节列表
- 内容阅读

### 移除的功能
❌ 表单视图 - 被流程配置替代
❌ 配置测试Tab - 统一到任务管理测试
❌ 代码生成功能 - 使用频率低

### 不兼容变更
⚠️ **UI组件API变化**
- 所有Ant Design组件改为Mantine组件
- 图标库从 `@ant-design/icons` 改为 `@tabler/icons-react`
- 表单处理从 `Form` 组件改为 `useForm` hook
- 消息通知从 `message` 改为 `notifications`

⚠️ **配置文件变化**
- 无变化，后端API保持兼容

⚠️ **构建流程变化**
- 添加Mantine相关依赖
- package.json需要更新

---

## 📊 技术架构对比

### V3 (Ant Design)
```javascript
技术栈:
  - React 18 + Vite
  - Ant Design 5.x
  - @ant-design/icons
  - React Router v6
  - React Flow

特点:
  - 企业级UI组件
  - 完善但传统的设计
  - CSS-in-JS (less)
```

### V4 (Mantine)
```javascript
技术栈:
  - React 18 + Vite
  - Mantine 7.x
  - @tabler/icons-react
  - React Router v6
  - React Flow
  - @emotion/react

特点:
  - 现代化UI组件
  - 灵活的主题系统
  - CSS-in-JS (@emotion)
  - 更好的TypeScript支持
```

---

## 🚀 快速开始 V4 开发

### 1. 克隆并切换分支
```bash
git clone https://github.com/cxapython/noval.git
cd noval
git checkout feature/ui-migration-mantine
```

### 2. 阅读技术文档
```bash
# 必读文档（1小时）
cat docs/RFC-Mantine迁移技术方案.md

# 快速了解（15分钟）
cat docs/UI迁移工作总结.md
```

### 3. 开始Phase 1
```bash
cd frontend
npm install @mantine/core@^7.0.0 \
            @mantine/hooks@^7.0.0 \
            @mantine/form@^7.0.0 \
            @mantine/notifications@^7.0.0 \
            @emotion/react@^11.11.0 \
            @tabler/icons-react@^2.40.0
```

详细步骤见：`docs/RFC-Mantine迁移技术方案.md` 第4节

---

## 📋 检查清单

### 代码准备 ✅
- [x] 移除冗余功能（1897行）
- [x] 精简配置编辑器
- [x] 精简爬虫管理器
- [x] 创建迁移分支
- [x] 推送到远程仓库

### 文档准备 ✅
- [x] RFC-001: 框架选型方案
- [x] RFC-002: Mantine技术方案
- [x] 功能精简方案
- [x] 工作总结
- [x] docs目录README
- [x] V4版本开发计划

### 环境准备 ⏳
- [ ] 安装Mantine依赖
- [ ] 配置主题
- [ ] 验证环境

---

## 🎯 里程碑

### Milestone 1: 环境搭建 (Day 1) ✅
**目标日期**: 2025-10-08  
**完成日期**: 2025-10-07  
**内容**: 完成Phase 1环境准备  
**验收**: Mantine测试组件正常显示 ✅

### Milestone 2: 公共组件 (Day 1-3) ✅
**目标日期**: 2025-10-10  
**完成日期**: 2025-10-07  
**内容**: 完成Phase 2公共组件迁移  
**验收**: Layout、规则编辑器、分页表单可用 ✅

### Milestone 3: 核心页面 (Day 3-8) ✅
**目标日期**: 2025-10-15  
**完成日期**: 2025-10-07  
**内容**: 完成Phase 3核心页面迁移  
**验收**: 智能向导、配置编辑、爬虫管理功能正常 ✅

### Milestone 4: 流程编辑器 (Day 8-10)
**目标日期**: 2025-10-17  
**内容**: 完成Phase 4流程编辑器迁移  
**验收**: 流程配置可视化编辑正常

### Milestone 5: 完成与发布 (Day 10)
**目标日期**: 2025-10-17  
**内容**: 完成Phase 5-6，测试发布  
**验收**: 所有功能通过测试，发布v4.0.0

---

## 📚 参考资源

### 项目文档
- [RFC-Mantine迁移技术方案](./RFC-Mantine迁移技术方案.md) ⭐ 必读
- [UI迁移工作总结](./UI迁移工作总结.md)
- [前端迁移-功能精简方案](./前端迁移-功能精简方案.md)
- [docs目录导航](./README.md)

### 官方文档
- [Mantine官网](https://mantine.dev/)
- [Mantine组件](https://mantine.dev/core/button/)
- [Tabler Icons](https://tabler-icons.io/)
- [Emotion](https://emotion.sh/)

### 代码示例
所有组件映射和代码示例见 `RFC-Mantine迁移技术方案.md` 第3节

---

## 🔐 分支策略

```
main (生产分支 - V3)
  └── feature/ui-migration-mantine (开发分支 - V4)
```

**合并策略：**
- V4开发完成后，创建PR合并到main
- 合并前需要通过：
  - ✅ 所有功能测试
  - ✅ 性能测试
  - ✅ Code Review
  - ✅ 文档更新

**版本发布：**
```bash
# V4完成后
git checkout main
git merge feature/ui-migration-mantine
git tag v4.0.0
git push origin main --tags
```

---

## 👥 贡献指南

### 代码规范
遵循 `RFC-Mantine迁移技术方案.md` 第5节代码规范：
- 统一的导入顺序
- 使用Mantine样式props
- 表单使用useForm hook
- 通知使用notifications

### Commit规范
```
feat: 新功能
fix: 修复bug
refactor: 重构
docs: 文档更新
style: 样式调整
test: 测试相关
```

---

## ⚠️ 注意事项

1. **不要在main分支直接开发** - 所有V4开发在 `feature/ui-migration-mantine` 分支
2. **保持V3可用** - main分支保持V3稳定版本
3. **渐进式迁移** - 按Phase顺序迁移，每个Phase完成后测试
4. **文档同步** - 代码变更同步更新文档
5. **性能监控** - 关注Bundle Size和加载性能

---

## 📞 联系方式

**项目仓库**: https://github.com/cxapython/noval  
**开发分支**: https://github.com/cxapython/noval/tree/feature/ui-migration-mantine  
**问题反馈**: https://github.com/cxapython/noval/issues

---

## 📅 更新日志

| 日期 | 版本 | 说明 |
|-----|------|-----|
| 2025-10-07 | v4.0.0-alpha.1 | 完成准备工作，创建开发分支 |
| 2025-10-07 | v4.0.0-alpha.2 | Phase 1 完成：环境准备 ✅ |
| 2025-10-07 | v4.0.0-alpha.3 | Phase 2 完成：公共组件迁移 ✅ |
| 2025-10-07 | v4.0.0-beta.1 | Phase 3 完成：核心页面迁移 ✅ |
| TBD | v4.0.0-beta.2 | Phase 4-5 完成 |
| TBD | v4.0.0-rc | Phase 4-5 完成 |
| TBD | v4.0.0 | 正式发布 |

---

**V4 开发进行中！** 🚀

**当前状态**: Phase 3 完成 ✅，准备开始 Phase 4  
**当前分支**: `feature/ui-migration-mantine`  
**远程地址**: `origin/feature/ui-migration-mantine`  
**进度**: 3/6 个 Phase 完成 (50%)

---

*最后更新: 2025-10-07*
