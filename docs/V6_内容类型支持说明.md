# V6 内容类型支持说明

## 概述

V6版本将原有的"小说爬虫"抽象为"内容爬虫"，支持多种内容类型：
- 📚 小说（Novel）
- 📰 新闻（News）
- 📝 文章（Article）
- ✍️ 博客（Blog）

## 核心改进

### 1. 配置结构升级

#### 新增字段
```json
{
  "content_type": "novel",  // 新增：内容类型
  "field_mapping": {         // 新增：字段显示映射（可选）
    "list_item": "小说/新闻",
    "item_title": "标题",
    "content_body": "内容"
  }
}
```

#### 兼容性
- ✅ 旧配置自动识别为`novel`类型
- ✅ 数据库字段保持不变（`novels`、`chapters`表通用）
- ✅ 爬虫逻辑完全复用

### 2. 前端改造

#### 配置向导
- **步骤1**：新增内容类型选择器
- **动态标签**：根据类型显示对应字段名
  - 小说：章节标题、章节内容
  - 新闻：标题、正文
  - 文章：文章标题、文章正文

#### 可视化选择器
- 自动适配字段类型选项
- 智能推荐字段类型

#### 配置预览
- 显示内容类型标签
- 步骤标题动态调整

### 3. 后端改造

#### 配置管理器
```python
# 自动兼容旧配置
if 'content_type' not in config:
    config['content_type'] = 'novel'

# 新增获取方法
def get_content_type(self) -> str:
    return self.config.get('content_type', 'novel')
```

#### 验证逻辑
- 放宽对新闻类型的URL模板验证
- 支持单页列表（无翻页）

## 使用示例

### 小说网站配置
```json
{
  "content_type": "novel",
  "site_info": {
    "name": "example_novel",
    "base_url": "https://example.com"
  }
  // ...
}
```

### 新闻网站配置
```json
{
  "content_type": "news",
  "site_info": {
    "name": "yicai_news",
    "base_url": "https://www.yicai.com"
  },
  "parsers": {
    "chapter_list": {
      "pagination": {
        "enabled": false  // 新闻通常不分页
      }
    }
  }
}
```

## 设计优势

### 1. 最小化改动
- ✅ 数据库无需改动
- ✅ 爬虫逻辑完全复用
- ✅ 仅需字段映射层调整

### 2. 高扩展性
- 新增类型只需在`contentTypes.js`添加配置
- 字段映射灵活可配

### 3. 向后兼容
- 旧配置无缝升级
- 用户无感知迁移

## 测试场景

### 新闻抓取示例
- **网站**：第一财经（https://www.yicai.com/）
- **目标**：首页新闻列表 → 新闻详情
- **特点**：单页列表、无翻页、无章节概念

### 配置流程
1. 选择"新闻"类型
2. 配置新闻列表XPath
3. 配置新闻详情XPath
4. 保存配置

## 后续优化

### 待实现功能
- [ ] 自定义字段定义
- [ ] 类型插件化
- [ ] 不同类型的专属功能（如新闻时效性）
- [ ] 更多预设模板

### 前端优化
- [ ] 阅读器界面适配不同类型
- [ ] 类型图标优化
- [ ] 更丰富的字段映射选项

## 技术细节

### 字段映射实现
```javascript
// contentTypes.js
export const FIELD_TYPE_LABELS = {
  novel: {
    chapter_list: {
      title: '章节标题',
      url: '章节链接'
    }
  },
  news: {
    chapter_list: {
      title: '新闻标题',
      url: '新闻链接'
    }
  }
};
```

### 动态字段获取
```javascript
const fieldTypes = getFieldTypes(contentType, pageType);
// 返回对应类型的字段配置
```

## 迁移指南

### 从旧版升级
1. 无需手动修改配置文件
2. 系统自动识别为`novel`类型
3. 功能完全兼容

### 创建新类型配置
1. 配置向导选择内容类型
2. 按照提示配置字段
3. 保存即可使用

## 注意事项

⚠️ **数据库字段名保持不变**：
- 虽然显示名称不同，但数据库字段名仍为：
  - `novels` → 内容集合
  - `chapters` → 内容条目

⚠️ **URL模板**：
- 新闻类型可能不需要复杂的URL模板
- 支持使用`{url}`占位符表示从列表直接获取

⚠️ **分页配置**：
- 新闻通常`pagination.enabled = false`
- 小说通常需要分页支持

## 贡献者

- 开发：AI Assistant
- 设计：基于用户需求

---

*更新时间：2025-10-14*
*版本：v6.0*

